{% extends "base.html" %}

{% block title %}{{ proyecto.nombre }} - LandLink{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row">
        <!-- Detalles del Proyecto -->
        <div class="col-lg-8">
            <div class="project-detail-card">
                <div class="project-header">
                    <h1>{{ proyecto.nombre }}</h1>
                    <div class="project-meta">
                        <span class="date">
                            <i class="fas fa-calendar"></i>
                            {{ proyecto.fecha.strftime('%d/%m/%Y') }}
                        </span>
                        <span class="location">
                            <i class="fas fa-map-marker-alt"></i>
                            {{ proyecto.ubicacion }}
                        </span>
                        <span class="area">
                            <i class="fas fa-tag"></i>
                            {{ proyecto.area.nombre }}
                        </span>
                    </div>
                </div>

                <div class="project-image">
                    {% if proyecto.imagen %}
                    <img src="{{ url_for('static', filename=proyecto.imagen) }}" alt="{{ proyecto.nombre }}">
                    {% else %}
                    <img src="{{ url_for('static', filename='images/default-project.jpg') }}" alt="Imagen por defecto">
                    {% endif %}
                </div>

                <div class="project-content">
                    <h2>Descripción</h2>
                    <p>{{ proyecto.descripcion }}</p>

                    <h2>Detalles</h2>
                    <div class="project-details">
                        <div class="detail-item">
                            <i class="fas fa-clock"></i>
                            <div>
                                <h4>Horario</h4>
                                <p>{{ proyecto.hora_inicio.strftime('%H:%M') }} - {{ proyecto.hora_fin.strftime('%H:%M') }}</p>
                            </div>
                        </div>
                        <div class="detail-item">
                            <i class="fas fa-users"></i>
                            <div>
                                <h4>Voluntarios Necesarios</h4>
                                <p>{{ proyecto.cupos_disponibles }} cupos disponibles</p>
                            </div>
                        </div>
                        <div class="detail-item">
                            <i class="fas fa-user-tie"></i>
                            <div>
                                <h4>Organizador</h4>
                                <p>{{ proyecto.organizador.get_full_name() }}</p>
                            </div>
                        </div>
                    </div>

                    {% if current_user.is_authenticated and not solicitud %}
                    <div class="project-actions">
                        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#solicitudModal">
                            Participar en este proyecto
                        </button>
                    </div>
                    {% elif solicitud %}
                    <div class="project-actions">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i>
                            Ya has enviado una solicitud para este proyecto. Estado: {{ solicitud.estado }}
                        </div>
                    </div>
                    {% else %}
                    <div class="project-actions">
                        <a href="{{ url_for('auth.login') }}" class="btn btn-primary">
                            Inicia sesión para participar
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4">
            <!-- Proyectos Relacionados -->
            <div class="related-projects">
                <h3>Proyectos Relacionados</h3>
                {% for proyecto_rel in proyectos_relacionados %}
                <div class="related-project-card">
                    <div class="related-project-image">
                        {% if proyecto_rel.imagen %}
                        <img src="{{ url_for('static', filename=proyecto_rel.imagen) }}" alt="{{ proyecto_rel.nombre }}">
                        {% else %}
                        <img src="{{ url_for('static', filename='images/default-project.jpg') }}" alt="Imagen por defecto">
                        {% endif %}
                    </div>
                    <div class="related-project-content">
                        <h4>{{ proyecto_rel.nombre }}</h4>
                        <p>{{ proyecto_rel.fecha.strftime('%d/%m/%Y') }}</p>
                        <a href="{{ url_for('auth.detalle_proyecto', project_id=proyecto_rel.id) }}" class="btn btn-sm btn-outline-primary">
                            Ver detalles
                        </a>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<!-- Modal de Solicitud -->
{% if current_user.is_authenticated and not solicitud %}
<div class="modal fade" id="solicitudModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Solicitar Participación</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form action="{{ url_for('auth.solicitar_proyecto', project_id=proyecto.id) }}" method="POST">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="mensaje" class="form-label">Mensaje (opcional)</label>
                        <textarea class="form-control" id="mensaje" name="mensaje" rows="3" 
                                placeholder="Cuéntanos por qué te interesa participar en este proyecto"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Enviar Solicitud</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/detalle_proyecto.css') }}">
<style>
.project-detail-card {
    background: #fff;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    overflow: hidden;
}

.project-header {
    padding: 2rem;
    background: #f8f9fa;
}

.project-header h1 {
    margin: 0 0 1rem;
    color: #333;
}

.project-meta {
    display: flex;
    gap: 1.5rem;
    color: #666;
}

.project-meta span {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.project-image {
    height: 400px;
    overflow: hidden;
}

.project-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.project-content {
    padding: 2rem;
}

.project-content h2 {
    margin: 2rem 0 1rem;
    color: #333;
}

.project-details {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin: 1.5rem 0;
}

.detail-item {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
}

.detail-item i {
    font-size: 1.5rem;
    color: #0d6efd;
}

.detail-item h4 {
    margin: 0 0 0.5rem;
    font-size: 1rem;
    color: #333;
}

.detail-item p {
    margin: 0;
    color: #666;
}

.project-actions {
    margin-top: 2rem;
    padding-top: 2rem;
    border-top: 1px solid #dee2e6;
}

.related-projects {
    background: #fff;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    padding: 1.5rem;
}

.related-projects h3 {
    margin: 0 0 1.5rem;
    color: #333;
}

.related-project-card {
    display: flex;
    gap: 1rem;
    padding: 1rem 0;
    border-bottom: 1px solid #dee2e6;
}

.related-project-card:last-child {
    border-bottom: none;
}

.related-project-image {
    width: 100px;
    height: 70px;
    border-radius: 5px;
    overflow: hidden;
}

.related-project-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.related-project-content {
    flex: 1;
}

.related-project-content h4 {
    margin: 0 0 0.5rem;
    font-size: 1rem;
    color: #333;
}

.related-project-content p {
    margin: 0 0 0.5rem;
    font-size: 0.875rem;
    color: #666;
}

@media (max-width: 768px) {
    .project-meta {
        flex-direction: column;
        gap: 0.5rem;
    }
    
    .project-image {
        height: 250px;
    }
    
    .project-details {
        grid-template-columns: 1fr;
    }
}
</style>
{% endblock %}
